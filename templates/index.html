<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Entry Form</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <h1>Fact Check Data Entry</h1>

    <form id="data-form">
        <div id="data-container">
            {% for item in data %}
            <div class="entry-group" data-entry-index="{{ loop.index0 }}">
                 <button type="button" class="remove-entry-btn" title="Remove this entry">X</button>
                <label>ID:</label>
                <input type="text" name="data[{{ loop.index0 }}][id]" value="{{ item.id }}" readonly>

                <label for="pf_url_{{ loop.index0 }}">Politifact URL:</label>
                <input type="url" id="pf_url_{{ loop.index0 }}" name="data[{{ loop.index0 }}][politifact_url]" value="{{ item.politifact_url }}">

                <label for="pf_headline_{{ loop.index0 }}">Politifact Headline:</label>
                <input type="text" id="pf_headline_{{ loop.index0 }}" name="data[{{ loop.index0 }}][politifact_headline]" value="{{ item.politifact_headline }}">

                <label for="pf_subheadline_{{ loop.index0 }}">Politifact Subheadline:</label>
                <input type="text" id="pf_subheadline_{{ loop.index0 }}" name="data[{{ loop.index0 }}][politifact_subheadline]" value="{{ item.politifact_subheadline }}">

                <label>Rating:</label>
                <div class="radio-group">
                    {% set ratings = ["full flop", "false", "mostly false", "half true", "mostly true", "true", "unrated"] %}
                    {% for rating in ratings %}
                        {% set rating_id = "rating_" ~ loop.parent.loop.index0 ~ "_" ~ rating|replace(" ", "_") %}
                        <label for="{{ rating_id }}">
                            <input type="radio" id="{{ rating_id }}" name="data[{{ loop.parent.loop.index0 }}][rating]" value="{{ rating }}" {% if item.rating == rating %}checked{% endif %}>
                            {{ rating|title }}
                        </label>
                    {% endfor %}
                </div>

                <label for="vid_duration_{{ loop.index0 }}">Video Duration (Politifact):</label>
                <input type="text" id="vid_duration_{{ loop.index0 }}" name="data[{{ loop.index0 }}][video_duration]" value="{{ item.video_duration }}">

                <label for="social_link_{{ loop.index0 }}">Social Link:</label>
                <input type="url" id="social_link_{{ loop.index0 }}" name="data[{{ loop.index0 }}][social_link]" value="{{ item.social_link }}">

                <label>Social Platform:</label>
                <input type="text" name="data[{{ loop.index0 }}][social_platform]" value="{{ item.social_platform }}" readonly>

                <label for="social_duration_{{ loop.index0 }}">Social Duration (seconds):</label>
                <input type="number" step="any" id="social_duration_{{ loop.index0 }}" name="data[{{ loop.index0 }}][social_duration]" value="{{ item.social_duration }}">

                <label for="social_text_{{ loop.index0 }}">Social Text:</label>
                <textarea id="social_text_{{ loop.index0 }}" name="data[{{ loop.index0 }}][social_text]" rows="3">{{ item.social_text }}</textarea>

                <label>External Links:</label>
                <div class="external-links-container">
                    {% if item.external_links_info %}
                        {% for link_pair in item.external_links_info %}
                         <div class="external-link-pair">
                             <input type="url" name="data[{{ loop.parent.loop.index0 }}][external_links_info][{{ loop.index0 }}][url]" value="{{ link_pair.url }}" placeholder="URL">
                             <input type="text" name="data[{{ loop.parent.loop.index0 }}][external_links_info][{{ loop.index0 }}][description]" value="{{ link_pair.description }}" placeholder="Description">
                             <button type="button" class="remove-link-btn">Remove</button>
                         </div>
                        {% endfor %}
                     {% endif %}
                </div>
                 <button type="button" class="add-link-btn">Add External Link</button>


                 <label>Download Status:</label>
                 <button type="button" class="download-btn">Download Video</button>
                 <input type="text" name="data[{{ loop.index0 }}][download_message]" value="{{ item.download_message }}" readonly placeholder="Download status message...">
                 <!-- Store boolean state in a hidden field for easier JS access -->
                 <input type="hidden" name="data[{{ loop.index0 }}][download_success]" value="{{ 'true' if item.download_success else 'false' }}">


                <label>Drive Path:</label>
                <input type="text" name="data[{{ loop.index0 }}][drive_path]" value="{{ item.drive_path }}" readonly>
            </div>
            {% else %}
            <p>No data yet. Click "Add New Entry" to start.</p>
            {% endfor %}
        </div>

        <hr>

        <button type="button" id="add-entry-btn">Add New Entry</button>
        <button type="button" id="save-all-btn">Save All Data</button>

    </form>

    <div class="import-section">
        <h2>Import Data</h2>
        <form method="post" action="{{ url_for('import_data') }}" enctype="multipart/form-data">
            <label for="jsonfile">Import JSON File:</label>
            <input type="file" id="jsonfile" name="jsonfile" accept=".json" required>
            <button type="submit">Import and Overwrite</button>
            <p><small>Warning: This will overwrite the current data.</small></p>
        </form>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>